<script>

let timer = null;
let isRunning = false;
let intervalTime = 8000;

const steps = [
  "1-step.mp3","2-step.mp3","3-step.mp3","4-step.mp3","5-step.mp3",
  "6-step.mp3","7-step.mp3","8-step.mp3","9-step.mp3",
  "cc.mp3","hook.mp3","toprock.mp3","power.mp3","freeze.mp3"
];

function fadeVolume(audio, target, duration) {
  const start = audio.volume;
  const diff = target - start;
  const steps = 20;
  let count = 0;

  const fade = setInterval(() => {
    count++;
    audio.volume = start + (diff * (count / steps));

    if (count >= steps) {
      clearInterval(fade);
      audio.volume = target;
    }
  }, duration / steps);
}

function playStep(file) {

  const music = document.getElementById("music");
  const sound = new Audio(file);

  sound.volume = 1.0;

  // fade nhạc xuống mượt
  fadeVolume(music, 0.05, 300);

  sound.play();

  sound.onended = function() {
    fadeVolume(music, 0.25, 500);
  };
}

function startTraining() {

  if (isRunning) return;
  isRunning = true;

  const music = document.getElementById("music");
  music.volume = 0.25;
  music.play();

  timer = setInterval(function() {

    const random = steps[Math.floor(Math.random() * steps.length)];
    playStep(random);

  }, intervalTime);
}

function stopTraining() {

  isRunning = false;

  if (timer) {
    clearInterval(timer);
    timer = null;
  }

  const music = document.getElementById("music");
  music.pause();
  music.currentTime = 0;
}

</script>
